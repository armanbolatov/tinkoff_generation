\documentclass{exam}

\input{../packages.tex}

\begin{document}
    
\textbf{Друзья останутся без подарков?}

\textbf{Условие:} $n$ друзей собрались и решили отправить письма Деду Морозу. У каждого есть $1$ конверт и $1$ письмо. Потом ребята всё перемешали и стали класть письма в конверты. Сколько в среднем писем попадёт в свой конверт?

\textbf{Решение:} Задачу можно переформулировать так: какое матожидание количества неподвижных точек при перестановке $n$ элементов.

Обозначим через $!n$ количество перестановок без неподвижных точек. Из формулы включения и исключения не сложно вывести, что 

$$!n = n!\left(1 - \frac{1}{1!} + \frac{1}{2!} - \frac{1}{3!} + \dots + (-1)^n\frac{1}{n!}\right) = n!\sum_{k=0}^{n}\frac{(-1)^k}{k!}$$

Вычислим количество перестановок при которых $k$ точек будут неподвижными. Для этого выберем эти $k$ точек которые будут стоять на своем месте ($C_{n}^{k}$ способов), а затем расставим оставшиеся $n - k$ не по своим местам. Так как каждая из оставшихся точек должна стоять не на своем месте, то количество их расстановок равно $!(n - k)$.

Выходит вероятность того, что в случайной перестановке будут ровно $k$ неподвижных точек равна $p_k = \frac{C_{n}^{k}\ \cdot\ !(n - k)}{n!}$. Следовательно искомое матожидание равно

$$\sum_{k=0}^{n}p_k\cdot k = \frac{\sum_{k=0}^{n} k \cdot C_{n}^{k}\ \cdot\ ! (n - k)}{n!}$$

\end{document}